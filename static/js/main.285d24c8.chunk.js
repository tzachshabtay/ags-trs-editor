(this["webpackJsonpags-trs-editor"]=this["webpackJsonpags-trs-editor"]||[]).push([[0],{169:function(e,t,n){e.exports=n(278)},174:function(e,t,n){},175:function(e,t,n){},278:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(9),o=n.n(r),l=(n(174),n(19)),s=n(13),c=n(29),u=n(30),h=n(31),d=(n(175),n(160)),f=n(317),m=n(309),p=i.a.createContext({}),g=function(e){return e.replace(/^\s+/,"")},v=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).focus=function(){n.input&&n.input.focus()},n.onLineChanged=function(e){n.context.lines[n.props.index]=e.target.value,n.setState({to:e.target.value})},n.onFocus=function(e){n.context.focused=n.props.index},n.state={to:e.to},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.context.lines[this.props.index]=this.state.to,this.context.focus[this.props.index]=this.focus}},{key:"componentWillUnmount",value:function(){this.context.focus[this.props.index]=null}},{key:"render",value:function(){var e=this,t=g(this.props.from),n=this.state.to?g(this.state.to):"";return i.a.createElement(m.a,{container:!0,alignItems:"center",direction:"row",spacing:0,style:{marginTop:5}},i.a.createElement(m.a,{item:!0,xs:1},i.a.createElement("span",null,this.props.index+1)),i.a.createElement(m.a,{item:!0,xs:11},i.a.createElement(f.a,{label:t,placeholder:"Missing translation",multiline:!0,margin:"normal",fullWidth:!0,value:n,onChange:this.onLineChanged,onFocus:this.onFocus,inputRef:function(t){t&&(e.input=t)}})))}}]),t}(i.a.Component);v.contextType=p;var x=n(149),b=n.n(x),y=n(150),E=n.n(y),k=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onSearch=function(e){if(e){var t={},a={},i=0,r=!0,o=!1,l=void 0;try{for(var s,c=n.props.lines.entries()[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value,h=Object(d.a)(u,2),f=h[0],m=h[1];(m.from.includes(e)||n.getTo(m).includes(e))&&(t[i]=f,a[f]=i,i+=1)}}catch(p){o=!0,l=p}finally{try{r||null==c.return||c.return()}finally{if(o)throw l}}n.context.searchRealToVisual=a,n.context.searchVisualToReal=t,n.setState({search:t,searchText:e})}else n.setState({search:null,searchText:""})},n.getTo=function(e){var t=n.context.lines[e.index];return void 0===t?e.to:t},n.rowRenderer=function(e){var t=e.key,a=e.index,r=(e.isScrolling,e.isVisible,e.style);n.state.search&&(a=n.state.search[a]);var o=n.props.lines[a],l=n.context.lines[a];return void 0===l&&(l=o.to),i.a.createElement("div",{key:t,style:r},i.a.createElement(v,{from:o.from,to:l,index:a}))},n.state={search:null,searchText:""},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;this.context.onSearch=this.onSearch;var t=this.state.search?Object.keys(this.state.search).length:this.props.lines.length;return i.a.createElement("div",{style:{paddingLeft:10,paddingTop:60,paddingBottom:10,height:"100%",flexGrow:1}},i.a.createElement(E.a,null,(function(n){var a=n.height,r=n.width;return i.a.createElement(b.a,{key:e.state.searchText,width:r,height:a,rowCount:t,rowHeight:80,rowRenderer:e.rowRenderer,ref:function(t){t&&(e.context.list=t)},style:{paddingBottom:10}})})))}}]),t}(i.a.Component);k.contextType=p;var T=n(313),C=n(148),w=n(314),j=n(315),O=n(319),R=n(158),S=n.n(R),V=n(155),P=n.n(V),F=n(156),M=n.n(F),L=n(157),A=n.n(L),N=n(154),U=n.n(N),B=n(153),W=n.n(B),G=n(159),I=n.n(G),D=n(312),H=n(316),J=n(151),z=n.n(J),$=n(5),_=Object($.a)({colorPrimary:{backgroundColor:"darkblue"},barColorPrimary:{backgroundColor:"lightblue"}})(D.a),q=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).getAt=function(e){return n.context.searchVisualToReal&&(e=n.context.searchVisualToReal[e]),n.props.lines[e]},n.getTo=function(e){var t=n.context.lines[e.index];return void 0===t?e.to:t},n.isMissing=function(e){return!!n.isVisible(e)&&!n.getTo(e)},n.isVisible=function(e){return!n.context.searchRealToVisual||e.index in n.context.searchRealToVisual},n.trackProgress=function(){if(n.props.lines&&n.context.lines){var e=0,t=!0,a=!1,i=void 0;try{for(var r,o=n.props.lines[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var l=r.value;n.isMissing(l)||(e+=1)}}catch(s){a=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}n.setState({full:e})}setTimeout(n.trackProgress,500)},n.getFocused=function(){return n.context.searchRealToVisual?n.context.searchRealToVisual[n.context.focused]||-1:n.context.focused||-1},n.focusLine=function(e){e.index in n.context.focus&&n.context.focus[e.index]()},n.findNext=function(e){var t=n.getFocused();t<0&&(t=0);var a=t,i=n.props.lines.length;n.context.searchRealToVisual&&(i=Object.keys(n.context.searchRealToVisual).length);for(var r=function(){a=(a+1)%i;var r=n.getAt(a);if(e(r)||a===t)return a>=i-1&&(a=i-2),a<0&&(a=-1),n.context.list.scrollToRow(a+1),setTimeout((function(){n.focusLine(r)}),100),"break"};;){if("break"===r())break}},n.findPrev=function(e){var t=n.getFocused(),a=n.props.lines.length;n.context.searchRealToVisual&&(a=Object.keys(n.context.searchRealToVisual).length),t<0&&(t=a-1);for(var i=t,r=function(){(i=(i-1)%a)<0&&(i=a-1);var r=n.getAt(i);if(e(r)||i===t)return i<=0&&(i=1),n.context.list.scrollToRow(i-1),setTimeout((function(){n.focusLine(r)}),100),"break"};;){if("break"===r())break}},n.onNextClicked=function(){n.findNext(n.isVisible)},n.onPreviousClicked=function(){n.findPrev(n.isVisible)},n.onNextMissingClicked=function(){n.findNext(n.isMissing)},n.onPreviousMissingClicked=function(){n.findPrev(n.isMissing)},n.genFile=function(){var e="".concat(n.props.comments,"\r\n"),t=!0,a=!1,i=void 0;try{for(var r,o=n.props.lines[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var l=r.value;e+="".concat(l.from,"\r\n").concat(n.getTo(l)||"","\r\n")}}catch(s){a=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}n.download(e)},n.download=function(e){var t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});t.href=URL.createObjectURL(n),t.download="ags.trs",document.body.appendChild(t),t.click()},n.upload=function(){n.props.upload()},n.onSearch=function(e){n.setState({searchValue:e}),setTimeout((function(){n.state.searchValue===e&&n.context.onSearch(e)}),200)},n.state={searchValue:""},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){setTimeout(this.trackProgress,500)}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement(T.a,{position:"fixed"},i.a.createElement(w.a,null,i.a.createElement(j.a,{variant:"h6",style:{paddingRight:50}},"AGS TRS Editor"),i.a.createElement(O.a,{title:"Load","aria-label":"load"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.upload},i.a.createElement(W.a,null))),this.props.lines&&i.a.createElement(i.a.Fragment,null,i.a.createElement(O.a,{title:"Save","aria-label":"save"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.genFile,style:{marginRight:50}},i.a.createElement(U.a,null))),i.a.createElement(O.a,{title:"Previous missing line","aria-label":"previous missing line"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.onPreviousMissingClicked},i.a.createElement(P.a,null))),i.a.createElement(O.a,{title:"Previous line (SHIFT + TAB)","aria-label":"previous line"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.onPreviousClicked},i.a.createElement(M.a,null))),i.a.createElement(O.a,{title:"Next line (TAB)","aria-label":"next line"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.onNextClicked},i.a.createElement(A.a,null))),i.a.createElement(O.a,{title:"Next missing line","aria-label":"next missing line"},i.a.createElement(C.a,{edge:"start",color:"inherit",onClick:this.onNextMissingClicked},i.a.createElement(S.a,null))),i.a.createElement(z.a,{value:this.state.searchValue,style:{paddingLeft:20},onChange:this.onSearch,onCancelSearch:function(){return e.onSearch("")}})),this.props.loading&&i.a.createElement(H.a,null),i.a.createElement("div",{style:{flexGrow:1}}),i.a.createElement(O.a,{title:"Source Code","aria-label":"source code"},i.a.createElement(C.a,{color:"inherit",target:"_blank",href:"https://github.com/tzachshabtay/ags-trs-editor/"},i.a.createElement(I.a,null)))),this.renderProgress()))}},{key:"renderProgress",value:function(){if(!this.props.lines)return null;var e=this.state&&this.state.full||0,t=Math.round(e/this.props.lines.length*100),n="".concat(e,"/").concat(this.props.lines.length," Completed (").concat(t,"%)");return i.a.createElement(O.a,{title:n,"aria-label":"progress"},i.a.createElement(_,{variant:"determinate",value:t}))}}]),t}(i.a.Component);q.contextType=p;var K=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return i.a.createElement(p.Provider,{value:{focus:{}}},i.a.createElement(Q,null))}}]),t}(i.a.Component),Q=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).startUpload=function(){n.setState({loading:!0},n.upload)},n.upload=function(){var e=document.createElement("input");e.type="file",e.style.display="none",e.onchange=function(t){var n=t.target.files[0];if(n){var a=new FileReader;a.onload=function(t){var n=t.target.result;e.func(n),document.body.removeChild(e)},a.readAsText(n)}},e.func=n.onUploaded,document.body.appendChild(e),e.click()},n.onUploaded=function(e){var t=e.replace(/\r/g,"").split("\n"),a=[],i=null,r=null,o="",l=0,s=!0,c=!1,u=void 0;try{for(var h,d=t[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var f=h.value;f.startsWith("//")?o="".concat(o,"\r\n").concat(f):null===i?i=f:null===r?r=f:(a.push({from:i,to:r,index:l}),l+=1,i=f,r=null)}}catch(m){c=!0,u=m}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}i&&(a.push({from:i,to:r,index:l}),l+=1),n.context.lines=new Array(a.length),n.setState({lines:a,comments:o},(function(){n.context.list&&setTimeout((function(){n.context.list.forceUpdateGrid(),n.context.list.forceUpdate(),n.context.list.scrollToRow(0)}),500)}))},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App",style:{height:"100%"}},i.a.createElement(q,{lines:this.state&&this.state.lines,comments:this.state&&this.state.comments,upload:this.startUpload,loading:this.state&&this.state.loading}),this.state&&this.state.lines&&i.a.createElement(k,{lines:this.state.lines,comments:this.state.comments}),(!this.state||!this.state.lines)&&i.a.createElement(j.a,{style:{paddingTop:100,paddingLeft:50}},"Please load a TRS file."))}}]),t}(i.a.Component);Q.contextType=p;var X=K;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[169,1,2]]]);
//# sourceMappingURL=main.285d24c8.chunk.js.map