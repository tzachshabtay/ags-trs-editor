(this["webpackJsonpags-trs-editor"]=this["webpackJsonpags-trs-editor"]||[]).push([[0],{169:function(e,t,n){e.exports=n(278)},174:function(e,t,n){},175:function(e,t,n){},278:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(9),o=n.n(i),l=(n(174),n(19)),s=n(13),c=n(29),u=n(30),h=n(31),d=(n(175),n(160)),f=n(317),m=n(309),p=r.a.createContext({}),g=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onLineChanged=function(e){n.context.lines[n.props.index]=e.target.value,n.setState({to:e.target.value})},n.onFocus=function(e){n.context.focused=n.props.index},n.state={to:e.to},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.context.lines[this.props.index]=this.state.to}},{key:"Focus",value:function(){this.input&&this.input.focus()}},{key:"render",value:function(){var e=this,t=this.props.from.trimStart(),n=this.state.to?this.state.to.trimStart():"";return r.a.createElement(m.a,{container:!0,alignItems:"center",direction:"row",spacing:0,style:{marginTop:5}},r.a.createElement(m.a,{item:!0,xs:1},r.a.createElement("span",null,this.props.index+1)),r.a.createElement(m.a,{item:!0,xs:11},r.a.createElement(f.a,{label:t,placeholder:"Missing translation",multiline:!0,margin:"normal",fullWidth:!0,value:n,onChange:this.onLineChanged,onFocus:this.onFocus,inputRef:function(t){t&&(e.input=t)}})))}}]),t}(r.a.Component);g.contextType=p;var v=n(149),b=n.n(v),x=n(150),y=n.n(x),E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onSearch=function(e){if(e){var t={},a={},r=0,i=!0,o=!1,l=void 0;try{for(var s,c=n.props.lines.entries()[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,h=Object(d.a)(u,2),f=h[0],m=h[1];(m.from.includes(e)||n.getTo(m).includes(e))&&(t[r]=f,a[f]=r,r+=1)}}catch(p){o=!0,l=p}finally{try{i||null==c.return||c.return()}finally{if(o)throw l}}n.context.searchRealToVisual=a,n.context.searchVisualToReal=t,n.setState({search:t})}else n.setState({search:null})},n.getTo=function(e){var t=n.context.lines[e.index];return void 0===t?e.to:t},n.rowRenderer=function(e){var t=e.key,a=e.index,i=(e.isScrolling,e.isVisible,e.style);n.state.search&&(a=n.state.search[a]);var o=n.props.lines[a],l=n.context.lines[a];return void 0===l&&(l=o.to),r.a.createElement("div",{key:t,style:i},r.a.createElement(g,{from:o.from,to:l,index:a,ref:function(e){e&&(o.ref=e)}}))},n.state={search:null},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;this.context.onSearch=this.onSearch;var t=this.state.search?Object.keys(this.state.search).length:this.props.lines.length;return r.a.createElement("div",{style:{paddingLeft:10,paddingTop:60,paddingBottom:10,height:"100%",flexGrow:1}},r.a.createElement(y.a,null,(function(n){var a=n.height,i=n.width;return r.a.createElement(b.a,{width:i,height:a,rowCount:t,rowHeight:80,rowRenderer:e.rowRenderer,ref:function(t){t&&(e.context.list=t)},style:{paddingBottom:10}})})))}}]),t}(r.a.Component);E.contextType=p;var k=n(313),T=n(148),C=n(314),w=n(315),j=n(319),O=n(158),S=n.n(O),R=n(155),P=n.n(R),V=n(156),F=n.n(V),M=n(157),A=n.n(M),N=n(154),L=n.n(N),U=n(153),B=n.n(U),G=n(159),W=n.n(G),I=n(312),D=n(316),H=n(151),J=n.n(H),z=n(5),$=Object(z.a)({colorPrimary:{backgroundColor:"darkblue"},barColorPrimary:{backgroundColor:"lightblue"}})(I.a),_=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).getAt=function(e){return n.props.lines[e]},n.getTo=function(e){var t=n.context.lines[e.index];return void 0===t?e.to:t},n.isMissing=function(e){return!!n.isVisible(e)&&!n.getTo(e)},n.isVisible=function(e){return!n.context.searchRealToVisual||e.index in n.context.searchRealToVisual},n.trackProgress=function(){if(n.props.lines&&n.context.lines){var e=0,t=!0,a=!1,r=void 0;try{for(var i,o=n.props.lines[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;n.isMissing(l)||(e+=1)}}catch(s){a=!0,r=s}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}n.setState({full:e})}setTimeout(n.trackProgress,500)},n.getFocused=function(){return n.context.searchRealToVisual?n.context.searchRealToVisual[n.context.focused]||-1:n.context.focused||-1},n.findNext=function(e){var t=n.getFocused();t<0&&(t=0);var a=t,r=n.props.lines.length;n.context.searchRealToVisual&&(r=Object.keys(n.context.searchRealToVisual).length);for(var i=function(){a=(a+1)%r;var i=n.getAt(a);if(e(i)||a===t)return a>=r-1&&(a=r-2),a<0&&(a=-1),n.context.list.scrollToRow(a+1),setTimeout((function(){i.ref&&i.ref.Focus()}),100),"break"};;){if("break"===i())break}},n.findPrev=function(e){var t=n.getFocused();t<0&&(t=n.props.lines.length-1);for(var a=t,r=function(){(a=(a-1)%n.props.lines.length)<0&&(a=n.props.lines.length-1);var r=n.getAt(a);if(e(r)||a===t)return a<=0&&(a=1),n.context.list.scrollToRow(a-1),setTimeout((function(){r.ref&&r.ref.Focus()}),100),"break"};;){if("break"===r())break}},n.onNextClicked=function(){n.findNext(n.isVisible)},n.onPreviousClicked=function(){n.findPrev(n.isVisible)},n.onNextMissingClicked=function(){n.findNext(n.isMissing)},n.onPreviousMissingClicked=function(){n.findPrev(n.isMissing)},n.genFile=function(){var e="".concat(n.props.comments,"\r\n"),t=!0,a=!1,r=void 0;try{for(var i,o=n.props.lines[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;e+="".concat(l.from,"\r\n").concat(n.getTo(l)||"","\r\n")}}catch(s){a=!0,r=s}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}n.download(e)},n.download=function(e){var t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});t.href=URL.createObjectURL(n),t.download="ags.trs",document.body.appendChild(t),t.click()},n.upload=function(){n.props.upload()},n.onSearch=function(e){n.setState({searchValue:e}),setTimeout((function(){n.state.searchValue===e&&n.context.onSearch(e)}),200)},n.state={searchValue:""},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){setTimeout(this.trackProgress,500)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{position:"fixed"},r.a.createElement(C.a,null,r.a.createElement(w.a,{variant:"h6",style:{paddingRight:50}},"AGS TRS Editor"),r.a.createElement(j.a,{title:"Load","aria-label":"load"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.upload},r.a.createElement(B.a,null))),this.props.lines&&r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{title:"Save","aria-label":"save"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.genFile,style:{marginRight:50}},r.a.createElement(L.a,null))),r.a.createElement(j.a,{title:"Previous missing line","aria-label":"previous missing line"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.onPreviousMissingClicked},r.a.createElement(P.a,null))),r.a.createElement(j.a,{title:"Previous line (SHIFT + TAB)","aria-label":"previous line"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.onPreviousClicked},r.a.createElement(F.a,null))),r.a.createElement(j.a,{title:"Next line (TAB)","aria-label":"next line"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.onNextClicked},r.a.createElement(A.a,null))),r.a.createElement(j.a,{title:"Next missing line","aria-label":"next missing line"},r.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.onNextMissingClicked},r.a.createElement(S.a,null))),r.a.createElement(J.a,{value:this.state.searchValue,style:{paddingLeft:20},onChange:this.onSearch,onCancelSearch:function(){return e.onSearch("")}})),this.props.loading&&r.a.createElement(D.a,null),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(j.a,{title:"Source Code","aria-label":"source code"},r.a.createElement(T.a,{color:"inherit",target:"_blank",href:"https://github.com/tzachshabtay/ags-trs-editor/"},r.a.createElement(W.a,null)))),this.renderProgress()))}},{key:"renderProgress",value:function(){if(!this.props.lines)return null;var e=this.state&&this.state.full||0,t=Math.round(e/this.props.lines.length*100),n="".concat(e,"/").concat(this.props.lines.length," Completed (").concat(t,"%)");return r.a.createElement(j.a,{title:n,"aria-label":"progress"},r.a.createElement($,{variant:"determinate",value:t}))}}]),t}(r.a.Component);_.contextType=p;var q=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement(p.Provider,{value:{}},r.a.createElement(K,null))}}]),t}(r.a.Component),K=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).startUpload=function(){n.setState({loading:!0},n.upload)},n.upload=function(){var e=document.createElement("input");e.type="file",e.style.display="none",e.onchange=function(t){var n=t.target.files[0];if(n){var a=new FileReader;a.onload=function(t){var n=t.target.result;e.func(n),document.body.removeChild(e)},a.readAsText(n)}},e.func=n.onUploaded,document.body.appendChild(e),e.click()},n.onUploaded=function(e){var t=e.replace(/\r/g,"").split("\n"),a=[],r=null,i=null,o="",l=0,s=!0,c=!1,u=void 0;try{for(var h,d=t[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var f=h.value;f.startsWith("//")?o="".concat(o,"\r\n").concat(f):null===r?r=f:null===i?i=f:(a.push({from:r,to:i,index:l}),l+=1,r=f,i=null)}}catch(m){c=!0,u=m}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}r&&(a.push({from:r,to:i,index:l}),l+=1),n.context.lines=new Array(a.length),n.setState({lines:a,comments:o},(function(){n.context.list&&setTimeout((function(){n.context.list.forceUpdateGrid(),n.context.list.forceUpdate(),n.context.list.scrollToRow(0)}),500)}))},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App",style:{height:"100%"}},r.a.createElement(_,{lines:this.state&&this.state.lines,comments:this.state&&this.state.comments,upload:this.startUpload,loading:this.state&&this.state.loading}),this.state&&this.state.lines&&r.a.createElement(E,{lines:this.state.lines,comments:this.state.comments}),(!this.state||!this.state.lines)&&r.a.createElement(w.a,{style:{paddingTop:100,paddingLeft:50}},"Please load a TRS file."))}}]),t}(r.a.Component);K.contextType=p;var Q=q;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[169,1,2]]]);
//# sourceMappingURL=main.c507528f.chunk.js.map